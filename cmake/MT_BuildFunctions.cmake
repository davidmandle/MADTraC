function(MT_MAKE_MODULE_HEADER dir mod_name src_list)

  set(header_file ${CMAKE_BINARY_DIR}/include/${mod_name}.h)

  file(WRITE ${header_file}
    "#ifndef  MT_HAVE_${mod_name}
#define  MT_HAVE_${mod_name}

/*
 *  ${mod_name}.h
 *  MADTraC
 *
 *  Header for the ${mod_name} module of MADTraC.  This header should
 *  include any other headers you need and define the proper
 *  preprocessor definitions.
 *
 *  Created by Daniel Swain on 2/20/10.
 *    - modified to be generated by CMake, DTS 9/26/10
 *
 */

#include \"MT_Config.h\"

")

  if(MSVC)
    file(APPEND ${header_file}
      "#ifdef _MSC_VER
#pragma comment(lib, \"opengl32.lib\")
#pragma comment(lib, \"glu32.lib\")
#pragma comment(lib, \"kernel32.lib\")
#pragma comment(lib, \"user32.lib\")
#pragma comment(lib, \"gdi32.lib\")
#pragma comment(lib, \"comdlg32.lib\")
#pragma comment(lib, \"winspool.lib\")
#pragma comment(lib, \"winmm.lib\")
#pragma comment(lib, \"shell32.lib\")
#pragma comment(lib, \"comctl32.lib\")
#pragma comment(lib, \"ole32.lib\")
#pragma comment(lib, \"oleaut32.lib\")
#pragma comment(lib, \"uuid.lib\")
#pragma comment(lib, \"rpcrt4.lib\")
#pragma comment(lib, \"advapi32.lib\")
#pragma comment(lib, \"wsock32.lib\")
#pragma comment(lib, \"wininet.lib\")

#pragma comment(lib, \"MT_Core.lib\")
#endif /* _MSC_VER */")
  endif(MSVC)

  get_directory_property(DEFS DIRECTORY ${dir} COMPILE_DEFINITIONS)
  foreach(def ${DEFS})
    file(APPEND ${header_file} "#ifndef ${def}\n    #define ${def}\n#endif\n\n")
  endforeach()

  foreach(sfile ${src_list})
    if(${sfile} MATCHES ".*\\.h")
      string(REPLACE "./" "MT/${mod_name}/" sfile ${sfile})
      file(APPEND ${header_file} "#include \"${sfile}\"\n")
    endif()
  endforeach()

  file(APPEND ${header_file} "\n#endif /* MT_HAVE_${mod_name} */\n")

endfunction(MT_MAKE_MODULE_HEADER)
